# Лабораторна робота: IaaS - Початок роботи з Microsoft Azure VM

**Мета:** Отримати практичний досвід використання системи Microsoft Azure для створення та налаштування віртуальних екземплярів Linux/Windows як веб-сервера.

**Завдання:**
1.  Створення VM **Windows Server**.
2.  Створення VM **Linux Ubuntu**.
3.  Налаштування **RDP** та **SSH**-з'єднань з VM.

**Лабораторне середовище:**
* Домашній/університетський ПК (Microsoft Windows / Linux / MacOS).
* RDP-клієнт (вбудований у Windows, або Microsoft Remote Desktop для MacOS/Linux).
* SSH-клієнт (вбудований у Linux/MacOS/Windows 10+, або PuTTY).

**Основні кроки (Зміст):**
[[#Крок 1 Вхід до порталу Azure]]
[[#Крок 2 Запуск VM Windows Server в Azure]]
[[#Крок 5 Запуск VM Linux Server в Azure]]
[[#Крок 8 Видалення ресурсів (!!!)]]

---

## Крок 1: Вхід до порталу Azure

1.  Створіть безкоштовний обліковий запис Azure. Вам знадобиться кредитна картка для верифікації (кошти не будуть списуватись у межах безкоштовного рівня) або скористайтеся акаунтом **Azure for Students**, якщо він доступний у вашому навчальному закладі.
2.  Увійдіть до **порталу Azure** за адресою: [https://portal.azure.com/](https://portal.azure.com/)

|              ![[Pasted image 20251103224856.png]]               |
| :-------------------------------------------------------------: |
| *Місце для скріншота: Головна панель (Dashboard) порталу Azure* |

---

## Крок 2: Запуск VM Windows Server в Azure

У цьому прикладі ми запустимо екземпляр Windows Server 2019 та автоматично встановимо на нього веб-сервер IIS за допомогою скрипту.

### 2.1. Створення Віртуальної Машини

1.  На головній панелі порталу Azure оберіть **"Virtual machines"** (Віртуальні машини).
2.  Натисніть **"+ Create"** -> **"Preset"**.
	
3.  На вкладці **"Basics"** (Основні) заповніть поля:
    * **Resource group:** Натисніть **"Create new"** (Створити нову) та введіть назву, наприклад, `WinServer-RG`.
    * **Virtual machine name:** Введіть унікальне ім'я, наприклад, `MyWinWebServer`.
    * **Region:** Оберіть регіон, наприклад, `(Europe) West Europe`.
    * **Availability zone:** Оберіть зону `Zone 3`.
    * **Size:** Оберіть розмір. Для безкоштовного рівня підійде `Standard_D4s`.
    * **Administrator account:** Створіть ім'я користувача (наприклад, `azureuser`) та **надійний пароль**. *Це ключова відмінність від AWS: ви одразу задаєте пароль, а не отримуєте його через .pem-файл.*
    * **Inbound port rules:**
        * **Public inbound ports:** Оберіть `Allow selected ports`.
        * **Select inbound ports:** Поставте галочки навпроти **`HTTP (80)`** та **`RDP (3389)`**.

|               ![[Pasted image 20251103225725.png]]               |
| :--------------------------------------------------------------: |
|               ![[Pasted image 20251103231524.png]]               |
|               ![[Pasted image 20251104003717.png]]               |
| *Місце для скріншота: Заповнена вкладка 'Basics' для Windows VM* |

### 2.2. Налаштування веб-сервера (Custom Data)

1.  Перейдіть на вкладку **"Advanced"** (Додатково).
2.  Прокрутіть вниз до секції **"Custom data"**.
3.  Вставте у текстове поле наступний PowerShell-скрипт. Цей скрипт автоматично встановить веб-сервер IIS, завантажить та розпакує той самий демонстраційний сайт, що й у лабораторній роботі з AWS.

**ЦЕЙ СКРИПТ НЕ РОБИТЬ СВОЮ ЗАДАЧУ, ТОЖ З НИМ ЩОСЬ ПЕРЕРОБИТИ**
```powershell
<powershell>
Install-WindowsFeature Web-Server -IncludeManagementTools -IncludeAllSubFeature remove-item -recurse c:\inetpub\wwwroot\* (New-Object System.Net.WebClient).DownloadFile("https://gitlab.com/karpenkoKhAI/ec2- template/-/raw/main/ec2-windows.zip", "c:\inetpub\wwwroot\ec2-windows.zip")

$shell = new-object -com shell.application 
$zip = $shell.NameSpace("c:\inetpub\wwwroot\ec2-windows.zip")
foreach($item in $zip.items()) 
{
	$shell.Namespace("c:\inetpub\wwwroot\").copyhere($item) 
}
</powershell>
```


|             ![[Pasted image 20251103231816.png]]              |
| :-----------------------------------------------------------: |
| *Місце для скріншота: Вкладка 'Advanced' з полем Custom Data* |

### 2.3. Додавання тегів та запуск

1.  Перейдіть на вкладку **"Tags"** (Теги).
2.  Додайте тег для легкої ідентифікації машини.
    * **Name:** `Name`
    * **Value:** `My Windows Web Server`
3.  Перейдіть на вкладку **"Review + create"** (Переглянути + створити).
4.  Після успішної валідації натисніть **"Create"**. Розгортання може зайняти кілька хвилин.

|              ![[Pasted image 20251103231841.png]]               |
| :-------------------------------------------------------------: |
|              ![[Pasted image 20251103232144.png]]               |
| *Місце для скріншота: Вкладка 'Review + create' перед запуском* |

---

## Крок 3: Перегляд веб-сервера (Windows)

1.  Після завершення розгортання натисніть **"Go to resource"** (Перейти до ресурсу).
2.  На сторінці **"Overview"** (Огляд) вашої нової VM знайдіть поле **"Public IP address"** та скопіюйте IP-адресу.
3.  Вставте цю IP-адресу у нову вкладку браузера (переконайтеся, що використовуєте `http://`, а не `httpsS://`).
4.  Ви маєте побачити сторінку "Welcome to the Cloud Computing Development Module!".
-
5. Якщо це не спрацювало, можете запустити `MyWinWebServer -> Overview -> Connect (зліва згори) -> Connect via Bastion` та створити сервер, натиснувши на запущеній машині `2. Add roles and features`, увімкнувши `Server Roles -> Web Server (IIS) -> Add features...`.

|                 ![[Pasted image 20251103232508.png]]                 |
| :------------------------------------------------------------------: |
|                 ![[Pasted image 20251103232800.png]]                 |
| *Місце для скріншота: Сторінка 'Overview' VM з публічною IP-адресою* |

|                ![[Pasted image 20251104015813.png]]                |
| :----------------------------------------------------------------: |
| *Місце для скріншота: Результат роботи веб-сервера IIS у браузері* |

---

## Крок 4: Підключення до Windows VM (RDP)

1.  На сторінці **"Overview"** (Огляд) вашої VM натисніть кнопку **"Connect"** (Підключити) та оберіть **"RDP"**.
2.  Залиште налаштування за замовчуванням (IP-адреса та порт 3389) і натисніть **"Download RDP File"**.
3.  Відкрийте завантажений `.rdp` файл.
4.  Натисніть "Connect" та введіть **ім'я користувача** (`azureuser`) та **пароль**, які ви створили у Кроці 2.1.
5.  Прийміть сертифікат безпеки, і ви побачите робочий стіл вашого Windows Server.

|          ![[Pasted image 20251104020259.png]]          |
| :----------------------------------------------------: |
| *Місце для скріншота: Меню 'Connect' -> 'RDP' в Azure* |

|         ![[Pasted image 20251104020307.png]]         |
| :--------------------------------------------------: |
| *Місце для скріншота: Машинка всередині RDP клієнта* |

---

## Крок 5: Запуск VM Linux Server в Azure

Тепер повторимо процес, але для створення Linux VM з веб-сервером Apache (LAMP).

### 5.1. Створення Віртуальної Машини

1.  Поверніться до сервісу **"Virtual machines"** та натисніть **"+ Create"** -> **"Azure virtual machine"**.
2.  На вкладці **"Basics"** (Основні) заповніть поля:
    * **Resource group:** Натисніть **"Create new"** та введіть назву, наприклад, `LinuxServer-RG`.
    * **Virtual machine name:** Введіть унікальне ім'я, наприклад, `MyLinuxWebServer`.
    * **Region:** Оберіть той самий регіон, що й раніше.
    * **Image:** Оберіть `Ubuntu Server 20.04 LTS - Gen2`.
    * **Size:** Оберіть `Standard_B1s`.
    * **Authentication type:** Оберіть **`SSH public key`**.
    * **Username:** Введіть ім'я користувача (наприклад, `azureuser`).
    * **SSH public key source:** Оберіть `Generate new key pair`.
    * **Key pair name:** Введіть назву ключа, наприклад, `my-linux-key`.
    * **Inbound port rules:**
        * **Public inbound ports:** `Allow selected ports`.
        * **Select inbound ports:** Поставте галочки навпроти **`HTTP (80)`** та **`SSH (22)`**.

|              ![[Pasted image 20251104145138.png]]              |
| :------------------------------------------------------------: |
| *Місце для скріншота: Заповнена вкладка 'Basics' для Linux VM* |

### 5.2. Налаштування веб-сервера (Custom Data)

1.  Перейдіть на вкладку **"Advanced"** (Додатково).
2.  Прокрутіть вниз до секції **"Custom data"**.
3.  Оскільки ми обрали Ubuntu, нам потрібен `apt` скрипт (а не `yum` з оригінальної лабораторної). Вставте наступний shell-скрипт:

```bash
#!/bin/sh
yum -y install httpd php mysql php-mysql

case $(ps -p 1 -o comm | tail -1) in systemd) systemctl enable --now httpd ;; init) chkconfig httpd on; service httpd start ;; *) echo "Error starting httpd (OS not using init or systemd)." 2>&1 esac 

if [ ! -f /var/www/html/bootcamp-app.tar.gz ]; then cd /var/www/html wget https://gitlab.com/karpenkoKhAI/ec2-template/-/raw/main/bootcamp-app.tar tar xvf bootcamp-app.tar chown apache:root /var/www/html/rds.conf.php
fi
yum -y update
```


|                 ![[Pasted image 20251104145226.png]]                  |
| :-------------------------------------------------------------------: |
| *Місце для скріншота: Вкладка 'Advanced' (Linux) з полем Custom Data* |

### 5.3. Запуск та завантаження ключа

1.  (Опціонально) Перейдіть на вкладку **"Tags"** та додайте тег `Name` = `My Linux Web Server`.
2.  Перейдіть на вкладку **"Review + create"** та натисніть **"Create"**.
3.  **ДУЖЕ ВАЖЛИВО:** З'явиться вікно з пропозицією згенерувати новий ключ. Натисніть **"Download private key and create resource"**.
4.  Збережіть `.pem` файл (наприклад, `my-linux-key.pem`). **Ви не зможете завантажити його знову.**

|                   ![[Pasted image 20251104145354.png]]                    |
| :-----------------------------------------------------------------------: |
| *Місце для скріншота: Діалогове вікно завантаження приватного .pem ключа* |

---

## Крок 6: Перегляд веб-сервера (Linux)

1.  Після розгортання перейдіть до ресурсу Linux VM.
2.  На сторінці **"Overview"** (Огляд) скопіюйте **"Public IP address"**.
3.  Вставте IP-адресу у браузер (`http://...`).
4.  Ви маєте побачити ту саму сторінку, але цього разу вона обслуговується сервером Apache на Linux.
-
5. Якщо це не спрацювало, можете перейти до [[#Крок 7 Підключення до Linux VM (SSH)|кроку 7]] та, підключившись до SSH, прописати на запущеній машині:
```bash
# Встановлюємо Apache, PHP та модуль для MySQL
sudo apt-get install -y apache2 php libapache2-mod-php php-mysql
# Вмикаємо автозапуск Apache (на випадок перезавантаження)
sudo systemctl enable apache2
```


|                 ![[Pasted image 20251104150347.png]]                 |
| :------------------------------------------------------------------: |
| *Місце для скріншота: Сторінка 'Overview' VM з публічною IP-адресою* |

|                 ![[Pasted image 20251104151703.png]]                  |
| :-------------------------------------------------------------------: |
| *Місце для скріншота: Результат роботи Apache/PHP сервера у браузері* |

---

## Крок 7: Підключення до Linux VM (SSH)

1.  На сторінці **"Overview"** (Огляд) вашої Linux VM натисніть **"Connect"** (Підключити) та оберіть **"SSH"**.
2.  Azure покаже вам готову команду для підключення. Вона матиме вигляд:
    `ssh -i "шлях/до/ключа/my-linux-key.pem" azureuser@<ВАША_IP_АДРЕСА>`
3.  Відкрийте термінал (Command Prompt, PowerShell, або термінал на Linux/MacOS).
4.  Перейдіть до папки, куди ви зберегли `.pem` файл. Наприклад: `cd C:\Users\YourUser\Downloads`
5.  (Лише для Linux/MacOS) Встановіть правильні дозволи для ключа: `chmod 400 my-linux-key.pem`
6.  Скопіюйте та виконайте команду SSH з порталу Azure.
7.  Введіть `yes` для підтвердження відбитку хоста.
8.  Ви успішно підключилися до вашої Linux VM.

|                   ![[Pasted image 20251104145915.png]]                    |
| :-----------------------------------------------------------------------: |
| *Місце для скріншота: Меню 'Connect' -> 'SSH' з командою для підключення* |

|           ![[Pasted image 20251104150108.png]]           |
| :------------------------------------------------------: |
| *Місце для скріншота: Успішне SSH-з'єднання у терміналі* |

---

## Крок 8: Видалення ресурсів (!!!)

**ВАЖЛИВО:** Щоб уникнути будь-яких витрат після завершення лабораторної роботи, обов'язково видаліть усі створені ресурси. В Azure найпростіший спосіб це зробити — видалити групи ресурсів.

1.  На порталі Azure перейдіть до **"Resource groups"** (Групи ресурсів).
2.  Ви побачите дві створені вами групи: `WinServer-RG` та `LinuxServer-RG` та одну нову `NetworkWatcherRG`.
3.  Оберіть першу групу (`WinServer-RG`) і на її сторінці натисніть **"Delete resource group"**.
4.  Введіть назву групи ресурсів для підтвердження та натисніть **"Delete"**.
5.  Повторіть цей процес для кожної групи (`LinuxServer-RG` та `NetworkWatcherRG`).
6.  Це повністю видалить VM, диски, IP-адреси та мережеві налаштування, пов'язані з ними.

|                  ![[Pasted image 20251104151918.png]]                   |
| :---------------------------------------------------------------------: |
|                  ![[Pasted image 20251104151817.png]]                   |
|                  ![[Pasted image 20251104151952.png]]                   |
| *Місце для скріншота: Процес видалення групи ресурсів (Resource Group)* |
